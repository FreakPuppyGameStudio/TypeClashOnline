<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Type Clash - Online</title>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    body {
      background: radial-gradient(circle at center, #101020, #050505);
      color: #e0e0ff;
      font-family: 'Courier New', monospace;
      text-align: center;
      margin: 0;
      padding: 0;
      overflow: hidden;
      animation: fadeIn 1s ease-out;
    }

    h1 {
      font-size: 2.4em;
      margin-top: 30px;
      color: #8f6fff;
      text-shadow: 0 0 15px #8f6fff;
      animation: fadeIn 1s ease-in;
    }

    .hidden { display: none; }

    button {
      background: linear-gradient(90deg, #5b2cff, #b044ff);
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
      margin: 8px;
      border-radius: 10px;
      transition: all 0.25s ease;
      box-shadow: 0 0 8px rgba(150, 50, 255, 0.4);
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(180, 90, 255, 0.7);
    }

    input, select {
      padding: 10px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
      background: #1b1b1b;
      color: #fff;
      outline: none;
      box-shadow: 0 0 8px rgba(255,255,255,0.1);
      transition: box-shadow 0.3s ease;
    }

    input:focus, select:focus {
      box-shadow: 0 0 12px rgba(120, 80, 255, 0.6);
    }

    #gameScreen {
      animation: fadeIn 0.6s ease-in;
    }

    #wordDisplay {
      font-size: 30px;
      margin: 20px 0;
      color: #00e0ff;
      text-shadow: 0 0 10px #00e0ff;
    }

    #playerList div {
      font-size: 18px;
      margin: 4px;
      color: #bdbdff;
    }

    #status {
      margin-top: 10px;
      font-size: 14px;
      color: #aaa;
    }

    footer {
      position: absolute;
      bottom: 10px;
      width: 100%;
      text-align: center;
      font-size: 13px;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>‚ö° Type Clash - Online ‚ö°</h1>

  <div id="mainMenu">
    <p>Introduce tu nombre:</p>
    <input id="playerNameInput" type="text" placeholder="Jugador legendario" />
    <br /><br />
    <button id="createGameBtn">üéÆ Crear Partida</button>
    <button id="joinGameBtn">üîó Unirse a Partida</button>
  </div>

  <div id="joinMenu" class="hidden">
    <p>Introduce el ID de la partida:</p>
    <input id="joinGameIdInput" type="text" placeholder="Ej: ABC12" />
    <br /><br />
    <button id="confirmJoinBtn">Unirse</button>
    <button onclick="showScreen('mainMenu')">Volver</button>
  </div>

  <!-- Nuevo men√∫ de configuraci√≥n -->
  <div id="configMenu" class="hidden">
    <h2>‚öôÔ∏è Configurar Partida</h2>
    <p>Selecciona el modo de victoria:</p>
    <select id="winMode">
      <option value="points">Por Puntos</option>
      <option value="time">Por Tiempo</option>
    </select>
    <br /><br />
    <p id="configLabel">Cantidad de puntos o segundos:</p>
    <input id="configValue" type="number" min="1" value="10" />
    <br /><br />
    <button id="startGameBtn">üöÄ Iniciar Partida</button>
    <button onclick="showScreen('mainMenu')">Volver</button>
  </div>

  <div id="gameScreen" class="hidden">
    <h2>Partida: <span id="gameIdDisplay"></span></h2>
    <p>Escribe r√°pido la palabra:</p>
    <div id="wordDisplay">---</div>
    <input id="inputField" type="text" placeholder="¬°Dale duro a las teclas!" autocomplete="off" />
    <div id="playerList"></div>
    <p id="status"></p>
    <button onclick="leaveGame()">üö™ Salir</button>
  </div>

  <footer> By: SorinaCrew :) </footer>

  <!-- Firebase y l√≥gica -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot, deleteField, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCBtxDoEyuP-H7Dzd7Z-l8ExuLXLBWJNfI",
      authDomain: "typpinigwar.firebaseapp.com",
      projectId: "typpinigwar",
      storageBucket: "typpinigwar.firebasestorage.app",
      messagingSenderId: "609691050073",
      appId: "1:609691050073:web:fae852b140f5312905d148",
      measurementId: "G-8L8KJR47S0"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let currentUser = { uid: null, name: null };
    let currentGameId = null;
    let unsubscribeGame = null;
    let winMode = "points";
    let winValue = 10;
    let gameTimer = null;

    const words = [
      // üåé Modismos latinos
      "chido", "√≥rale", "cuate", "che", "parce", "bacano", "pana", "asere", "ch√©vere", "causa", "bo", "√±a√±ito", "vale", "t√≠o", "vacano",
      
      // üéÆ Videojuegos
      "Minecraft", "Fortnite", "GTA", "AmongUs", "Overwatch", "Valorant", "Pok√©mon", "Mario", "Luigi", "Link", "Zelda", "Sonic", "Crash", "noob", "AFK", "tryhard", "GG", "lagazo", "buff", "nerf", "grindear",
      
      // üé¨ Pel√≠culas y series
      "Grogu", "Wakanda", "Thanos", "Mandaloriano", "Frodo", "Gollum", "Hogwarts", "AvadaKedavra", "Neo", "Matrix", "JohnWick", "Toretto", "Familia", "Heisenberg", "SayMyName", "BreakingBad", "Jedi", "Sith", "Shrek", "Donkey", "PeakyBlinders", "Vecna", "UpsideDown",
      
      // üïπÔ∏è Cultura pop e internet
      "Sigma", "Ohio", "Rizz", "Cheems", "Doge", "UwU", "XD", "rickroll", "based", "meta", "sus", "toxic", "cringe", "meme", "NPC", "Skibidi", "fanboy", "waifu", "senpai", "otaku",
      
      // ü§ì Frases y diversi√≥n
      "modoDios", "ping", "internet", "c√≥digo", "bug", "respawn", "glitchear", "XP", "rankear", "crack", "fiera", "m√°quina", "tremendo", "√©pico"
    ];

    function showScreen(id) {
      ["mainMenu", "joinMenu", "configMenu", "gameScreen"].forEach(x => document.getElementById(x)?.classList.add("hidden"));
      document.getElementById(id)?.classList.remove("hidden");
    }

    function addEventListeners() {
      document.getElementById("createGameBtn").addEventListener("click", () => showScreen("configMenu"));
      document.getElementById("joinGameBtn").addEventListener("click", () => showScreen("joinMenu"));
      document.getElementById("confirmJoinBtn").addEventListener("click", joinGame);
      document.getElementById("startGameBtn").addEventListener("click", createGame);
      document.getElementById("inputField").addEventListener("input", handleTyping);
      document.getElementById("winMode").addEventListener("change", e => {
        document.getElementById("configLabel").textContent = e.target.value === "time"
          ? "Duraci√≥n (segundos):"
          : "Puntos para ganar:";
      });
    }

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser.uid = user.uid;
        showScreen("mainMenu");
        addEventListeners();
      } else {
        await signInAnonymously(auth);
      }
    });

    async function createGame() {
      winMode = document.getElementById("winMode").value;
      winValue = parseInt(document.getElementById("configValue").value);
      const name = document.getElementById("playerNameInput").value || "Jugador";
      const gameId = Math.random().toString(36).substring(2, 7).toUpperCase();
      currentGameId = gameId;
      currentUser.name = name;

      const gameRef = doc(db, "games", gameId);
      await setDoc(gameRef, {
        players: { [currentUser.uid]: { name, score: 0 } },
        word: randomWord(),
        createdAt: serverTimestamp(),
        mode: winMode,
        goal: winValue,
        startTime: Date.now()
      });

      subscribeToGame(gameId);
      showScreen("gameScreen");
      document.getElementById("gameIdDisplay").textContent = gameId;

      if (winMode === "time") startTimer(winValue);
    }

    async function joinGame() {
      const gameId = document.getElementById("joinGameIdInput").value.trim();
      const name = document.getElementById("playerNameInput").value || "Jugador";
      const gameRef = doc(db, "games", gameId);
      const snap = await getDoc(gameRef);
      if (!snap.exists()) return alert("‚ùå La partida no existe");

      const data = snap.data();
      currentGameId = gameId;
      currentUser.name = name;
      await updateDoc(gameRef, { [`players.${currentUser.uid}`]: { name, score: 0 } });
      subscribeToGame(gameId);
      showScreen("gameScreen");
      document.getElementById("gameIdDisplay").textContent = gameId;

      if (data.mode === "time") startTimer(data.goal - Math.floor((Date.now() - data.startTime) / 1000));
    }

    function randomWord() {
      return words[Math.floor(Math.random() * words.length)];
    }

    function startTimer(seconds) {
      clearInterval(gameTimer);
      let remaining = seconds;
      const status = document.getElementById("status");
      gameTimer = setInterval(() => {
        status.textContent = `‚è∞ Tiempo restante: ${remaining}s`;
        if (remaining <= 0) {
          clearInterval(gameTimer);
          status.textContent = "üèÅ ¬°Se acab√≥ el tiempo!";
          leaveGame();
        }
        remaining--;
      }, 1000);
    }

    function subscribeToGame(gameId) {
      const ref = doc(db, "games", gameId);
      if (unsubscribeGame) unsubscribeGame();
      unsubscribeGame = onSnapshot(ref, (snap) => {
        if (!snap.exists()) {
          alert("Partida finalizada");
          showScreen("mainMenu");
          return;
        }
        const data = snap.data();
        updateGameUI(data);
        checkWin(data);
      });
    }

    function updateGameUI(data) {
      document.getElementById("wordDisplay").textContent = data.word;
      const list = document.getElementById("playerList");
      list.innerHTML = "";
      for (const uid in data.players) {
        const p = data.players[uid];
        const div = document.createElement("div");
        div.textContent = `${p.name}: ${p.score}`;
        list.appendChild(div);
      }
    }

    async function handleTyping() {
      const input = document.getElementById("inputField");
      const ref = doc(db, "games", currentGameId);
      const snap = await getDoc(ref);
      if (!snap.exists()) return;
      const data = snap.data();

      if (input.value.trim().toLowerCase() === data.word.toLowerCase()) {
        input.value = "";
        const newWord = randomWord();
        await updateDoc(ref, {
          word: newWord,
          [`players.${currentUser.uid}.score`]: data.players[currentUser.uid].score + 1
        });
      }
    }

    function checkWin(data) {
      if (data.mode === "points") {
        for (const uid in data.players) {
          if (data.players[uid].score >= data.goal) {
            alert(`üéâ ${data.players[uid].name} gan√≥ la partida con ${data.goal} puntos!`);
            leaveGame();
          }
        }
      }
    }

    async function leaveGame() {
      if (!currentGameId) return;
      clearInterval(gameTimer);
      const ref = doc(db, "games", currentGameId);
      await updateDoc(ref, { [`players.${currentUser.uid}`]: deleteField() });
      unsubscribeGame?.();
      showScreen("mainMenu");
      currentGameId = null;
    }
  </script>
</body>
</html>
